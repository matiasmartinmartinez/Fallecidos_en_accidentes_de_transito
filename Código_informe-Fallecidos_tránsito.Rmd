---
title: "Siniestros de tránsito fatales en Uruguay, 2012-2017"
author: "Martínez Matías, Zang Bruno"
date: "24 de mayo de 2018"
output: pdf_document
params:
plot: NA
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introducción:

El presente estudio surge de la curiosidad por conocer el comportamiento de los siniestros de tránsitos en Uruguay y posee como objetivo madre una profunda aplicación de los conocimientos adquiridos en la asignatura "Nuevas técnicas para el análisis de datos", marcando énfasis en un correcto análisis exploratorio y la generación de adecuadas visualizaciones de los datos.
Se analizara tanto los datos del fallecido como lo del suceso.




### Antecedentes
En su programa de Sistema de Información Nacional de Tránsito (SINATRÁN), donde se extrajo los datos, la Unidad Nacional de Seguridad Vial (UNASEV), genera un informe anual sobre la Siniestralidad Vial en Uruguay para el periodo dado desde 2009 a la actualidad.
Dicho informes se pueden encontrar a través del siguiente enlace:http://unasev.gub.uy/inicio/sinatran/informes_siniestralidad_vial_uruguay/

## Datos obtenidos

Los datos fueron obtenidos de la Unidad Nacional de Seguridad Víal (UNASEV), correspondientes al período comprendido entre 2013 y 2017. Originalmennte los datos correspondían al año 2017, sin embargo se identificó apropiada la utilización de una serie de tiempo por lo cual se mecharon bases desde el año 2013, esto provocó ciertos inconvenientes en cuanto a nombres de variables debido a la utilizacion de tildes o el aumento de variables para ciertos años pero finalmente fueron solucionados y concluimos en una base de datos apta y abarcativa.

Mediante su catálogo de datos abiertos se extraen las bases utilizadas, desde el siguiente url: http://unasev.gub.uy/inicio/sinatran/datos_abiertos/

### Población:
Corresponde a los 2527 fallecidos en accidentes de tránsito dentro del territorio uruguayo para el período antes señalado.

### Descripción de las variables:

Se poseen 15 variables identificadas de la siguiente manera:

- **a:** Año. 
- **fecha:** Dia y Mes. 
- **hora:** Hora.
- **dep:** Departamento.
- **jur:** Juridición.
- **tipo.sin:** Tipo de Siniestro.
- **vehi:** Vehiculo.
- **rol:** Rol que cumplía.
- **edad:** Edad al fallecer.
- **Sexo:** Sexo de la persona.
- **f.dias:** Dia de supervivencia.
- **otro.vehi:** Otro vehiculo involucrado.
- **dir:** Lugar del accidente.
- **x:** Latitud.
- **y:** Longitud.

## Modelos y herramientas:

Es importarte recordar los objetivos del estudio, uno de ellos guía a la implementación de apropiadas visualizaciones. Para esto se utilizará el software estadístico R, con la puntual aplicación de paquete "tidyverse", que proporciona un conjunto de librerías óptimas para el análisis exploratorio de datos.
Con el fin de crear visualizaciónes oportunas se gestará su formación con la librería "ggplot2", perteneciente a tidyverse, la cual al trabajar mediante acumulación de capas (layers) posee una mayor flexibilidad y permite generar gráficos que representen correctamente los datos, sin generar interpretaciones confusas. Toma como referencia una metodología de visualización de datos llamada the Grammar of Graphics (Wilkinson, 2005), que consiste en especificar de manera independiente las componentes del gráfico como si fuesen bloques y luego combinarlas.


## Preguntas a responder

 - ¿Cuál es la distribución relativa por sexo y qué comportamiento posee la edad en el período dado?

 - ¿Cuál es la densidad de fallecidos por departamento?
 
 - ¿Existe relación entre el vehículo del fallecido y su rol en el mismo?
 
 - ¿Cuál es la frecuencia relativa según el tipo de siniestro para cada año?
 
 - ¿Cuál es la media de días de supervivencia luego del accidente?
 
 - ¿Hay relación entre el vehículo del fallecido y otro posible vehículo involucrado en el accidente?




## 

```{r,echo=F}
library(tidyverse)
library(knitr)
library(ggmosaic)
library(plotly)
load("~/Trabajo-Final-NT_Fallecidos_transito/Base_datos/base_datos___fallecidos_transito_uruguay_2013-2017.RData")
```
## Análisis Exploratorio de Datos

```{r}
dim(datos)
str(datos)

#Sexo
ggplotly(datos %>% count(a,sexo) %>% ggplot() + geom_mosaic(aes(weight=n,x=product(sexo,a),fill=sexo)))

datos %>% count(sexo) %>% mutate(n=n/sum(n)) %>% ggplot(aes(reorder(sexo,-n),n)) + geom_bar(stat="identity",aes(fill=sexo),show.legend = F) + labs(x="Año", y=" Frecuencia relativa de fallecidos",title="Gráfico de barras: frecuencia relativa fallecidos por sexo")

#Fallecidos por año

ggplotly(datos %>% count(a) %>% mutate(prop=n/sum(n)) %>% ggplot(aes(reorder(a,-prop),prop)) + geom_bar(stat="identity",aes(fill=a),show.legend = F) + labs(x="Año", y=" Frecuencia relativa de fallecidos",title="Gráfico de barras: frecuencia relativa fallecidos por año"))

# Relación vehículo - rol

datos %>% count(vehi,rol) %>% filter(n>=25) %>% ggplot() + geom_mosaic(aes(weight=n,x=product(abbreviate(vehi,4)),fill=abbreviate(rol,1)))+labs(x="Vehículo",title="Gráfico de mosaico: rol según vehículo") + guides(fill = guide_legend(title = "Rol")) + theme_minimal()

##Departamento por año
datos %>% count(dep,a) %>% ggplot(aes(reorder(abbreviate(dep,1),-n),n,group=a)) + geom_bar(stat="identity")+ labs(x="Departamento",y="Frecuencia acumulada",title="Gráfico de barras: frecuencia acumulada por departamento") +theme(plot.title = element_text(hjust = 0.5,colour="palegreen4",size=15,face="italic"))+ facet_wrap(~a) + coord_flip()
datos %>% plot_ly(x=~(abbreviate(dep,4)),frame=~a,type="histogram")%>% animation_opts( 2000,transition=2000, mode = "next")

datos %>% ggplot()+ geom_density(aes(edad)) + labs(x="Edad",y="Densidad") + facet_wrap(~a) + theme_minimal()

datos %>% count(jur) %>% mutate(prop=n/sum(n)) %>% ggplot() + geom_bar(stat="identity",aes(jur,prop))

datos %>% ggplot() + geom_density(aes(f.dias))
datos %>% ggplot() + stat_boxplot(aes(rol,edad,fill=sexo),show.legend = F)+ facet_wrap(~sexo)

datos %>% count(vehi,a) %>% mutate(prop=n/sum(n)) %>% ggplot(aes(reorder(vehi,-prop),prop)) + geom_bar(stat="identity") + facet_wrap(~a)

datos %>% count(vehi,otro.vehi) %>% filter(n>=80) %>% ggplot() + geom_mosaic(aes(weight=n,x=product(vehi),fill=otro.vehi))+ labs(x="Vehículo", y="Frecuencia Relativa") + guides(fill = guide_legend(title = "Otro Vehículo involucrado")) + theme_minimal()
```
